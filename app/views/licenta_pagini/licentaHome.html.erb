<% tema = Tema.find(@licenta.tema_id) %>
<h1><%= tema.nume%></h1>
<br/><br/>
<!-- <hr> -->

<!-- notificari -->
<% if flash[:notice] %>
   <div id="notice"><%= flash[:notice] %></div>
   <hr>
<% end %>

<div class="progress">
	<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%= @progres %>%;"><span style="color:black"><%= @progres %>%</span></div>
</div>

<div class="container">
<div class="row row-offcanvas-right">

<!-- capitole si todos -->
<div class="col-sm-8">	
	
	<%if @capitole.count == 0%>
		Nu sunt capitole.
	<%else%>

		<table class="table table-striped table hover">
			<thead>
			<tr>
				<th class="col-sm-1">Nr.</th>
				<% if @current_user.rol == "Student" %>
				<th class="col-sm-9">Titlu Capitol</th>
				<th class="col-sm-1">Mutare</th>
				<% elsif @current_user.rol == "Profesor" %>
				<th>Titlu Capitol</th>
				<% end %>
			</tr>
			</thead>
			<tbody>
				<% @capitole.order(:numar).each do |capitol| %>
					<tr>
						<td>Cap <%= capitol.numar %>.</td>
						<td><%= link_to capitol.nume, capitol %></td>
						<% if @current_user.rol == "Student" %>
						<td>
							<% if capitol.numar > 1 %>
								<%= link_to "", licentaHome_path(capitol_id: capitol.id, numar_nou: (capitol.numar-1), numar_victima: capitol.numar, capitol_victima_id: @capitole.find_by_numar(capitol.numar-1)), class: "glyphicon glyphicon-arrow-up" %>
							<% end %>
							<% if capitol.numar < @capitole.count %>
								<%= link_to "", licentaHome_path(capitol_id: capitol.id, numar_nou: (capitol.numar+1), numar_victima: capitol.numar, capitol_victima_id: @capitole.find_by_numar(capitol.numar+1)), class: "glyphicon glyphicon-arrow-down" %>
							<% end %>
						</td>
						<% end %>
					</tr>
					<tr>
						<td></td>
						<td>
							<% Todo.where(capitol_id: capitol.id).each do |todo| %>
						<%if current_user.rol == "Student"%>
						<% if todo.este_gata %>
							<li style="color:green"><strike><%= link_to todo.continut, edit_todo_path(todo, capitol_id: capitol.id), {:style => "color:green"} %></strike></li>
						<%else%>
							<li style="color:red"><%= link_to todo.continut, edit_todo_path(todo, capitol_id: capitol.id), {:style => "color:red"} %></li>
						<%end%>
						<%else%>
							<% if todo.este_gata %>
								<li style="color:green"><strike><%= todo.continut %></strike></li>
							<%else%>
								<li style="color:red"><%= todo.continut %></li>
							<%end%>
						<%end%>
					<%end%>
						</td>
						<% if @current_user.rol == "Student" %>
						<td></td>
						<% end %>
					</tr>
				<% end %>	
				<% if @current_user.rol == "Student" %>
				<tr>
					<td></td>
					<td>
						<!-- Daca user-ul curent logat este si cel care va lucra la aceasta licenta, avem si link pt a adauga un nou capitol--> 
						<%if current_user.id == @licenta.user_id%> 
							<%=link_to '+ Adauga capitol', new_capitol_path(:licenta => @licenta.id)%>
						<%end%>
					</td>
					<td></td>
				</tr>
				<% end %>
			</tbody>
		</table>

	<%end%>
</div>


<!-- comentarii pe dreapta -->
<div class="col-sm-3 sidebar-offcanvas" style="overflow:auto; height: 550px">
	<%if @comentarii.count == 0%>
		Nu sunt comentarii.
	<%else%>
		<%@comentarii.each do |comentariu|%>
			<% if User.find(comentariu.user_id).rol == "Profesor" %>
				<div class="panel panel-default">
				  <div class="panel-heading">
				    	<b><%= User.find(comentariu.user_id).nume + " " + User.find(comentariu.user_id).prenume%> : </b><br/> 
						<em><%= comentariu.created_at.strftime("%d %b. %Y,  %H:%M") %></em>
				  </div>
				  <div class="panel-body">
				    <%= comentariu.continut %>
				  </div>
				</div>
				<!-- <p style="color:green"> -->
				<!-- <b><= User.find(comentariu.user_id).nume + " " + User.find(comentariu.user_id).prenume%> : </b>  -->
				<!-- <em><= comentariu.created_at.strftime("%d %b. %Y,  %H:%M") %></em> -->
				<!-- <br/> -->
				<!-- <=comentariu.continut%></p> -->
			<% else %>
				<div class="panel panel-info">
				  <div class="panel-heading">
				    	<b><%= User.find(comentariu.user_id).nume + " " + User.find(comentariu.user_id).prenume%> : </b><br/> 
						<em><%= comentariu.created_at.strftime("%d %b. %Y,  %H:%M") %></em>
				  </div>
				  <div class="panel-body">
				    <%= comentariu.continut %>
				  </div>
				</div>
				<!-- <p style="color:blue"> -->
				<!-- <b><= User.find(comentariu.user_id).nume + " " + User.find(comentariu.user_id).prenume%> : </b> -->
				<!-- <em><= comentariu.created_at.strftime("%d %b. %Y,  %H:%M") %></em> -->
				<!-- <br/> -->
				<!-- <=comentariu.continut%></p> -->
			<% end %>
		<%end%>
	<%end%>
		
	<%= form_tag(licentaHome_adauga_comentariu_path(:student_id => @student_id), method: "post") do%>
			<%= hidden_field_tag(:licenta, @licenta.id , class: "form-control") %>
		<div class="field">
			<%= text_area_tag(:comentariu, nil , :required => true, class: "form-control",rows:5) %>
		</div>
		<br/>

		<%= submit_tag "AdaugÄƒ comentariu", class: "btn btn-primary" %>
	
	<%end%>
</div>

</div>
</div>


